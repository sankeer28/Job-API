<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Playground — Job API</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Crect x='2' y='7' width='16' height='11' stroke='white' stroke-width='1.5' fill='none'/%3E%3Cpath d='M7 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2' stroke='white' stroke-width='1.5' fill='none'/%3E%3Ccircle cx='9.5' cy='12.5' r='2.8' stroke='white' stroke-width='1.3' fill='none'/%3E%3Cpath d='M11.5 14.5L13.5 16.5' stroke='white' stroke-width='1.3' stroke-linecap='round'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --blue:   #0071E3;
      --blue-h: #0077ED;
      --bg:     #F5F5F7;
      --surface:#FFFFFF;
      --border: rgba(0,0,0,.08);
      --text:   #1D1D1F;
      --sub:    #6E6E73;
      --green:  #34C759;
      --red:    #FF3B30;
      --orange: #FF9500;
      --r: 0;
      --rs: 0;
      --font:   'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      --mono:   'JetBrains Mono', monospace;
      --dark-bg:     #0D0D0D;
      --dark-surf:   #161616;
      --dark-border: rgba(255,255,255,.07);
    }
    html.dark {
      --bg:      #000;
      --surface: #1C1C1E;
      --border:  rgba(255,255,255,.08);
      --text:    #F5F5F7;
      --sub:     #98989D;
    }
    html.dark nav { background: rgba(0,0,0,.78); border-bottom-color: rgba(255,255,255,.06); }
    html.dark input, html.dark select, html.dark textarea {
      background: rgba(255,255,255,.05); color: var(--text); border-color: var(--border);
    }
    html.dark input::placeholder, html.dark textarea::placeholder { color: #555; }

    body {
      font-family: var(--font);
      background: var(--bg); color: var(--text);
      height: 100vh; display: flex; flex-direction: column; overflow: hidden;
    }

    /* ── Nav ── */
    nav {
      position: relative; z-index: 10; flex-shrink: 0; height: 48px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 32px;
      background: rgba(255,255,255,.92);
      backdrop-filter: saturate(180%) blur(24px);
      -webkit-backdrop-filter: saturate(180%) blur(24px);
      border-bottom: 1px solid var(--border);
      animation: navIn .55s cubic-bezier(.22,1,.36,1) forwards;
    }
    @keyframes navIn { from { transform: translateY(-100%); opacity: 0; } to { transform: none; opacity: 1; } }
    .nav-logo {
      font-size: 15px; font-weight: 700; letter-spacing: -.4px;
      color: var(--text); text-decoration: none;
      display: flex; align-items: center; gap: 8px;
    }
    .nav-logo-mark {
      width: 28px; height: 28px; background: transparent;
      display: flex; align-items: center; justify-content: center;
    }
    .nav-links {
      position: absolute; left: 50%; transform: translateX(-50%);
      display: flex; align-items: center; gap: 2px;
    }
    .nav-link {
      font-size: 13px; font-weight: 500; color: var(--sub);
      text-decoration: none; padding: 5px 14px; border-radius: 0;
      transition: background .15s, color .15s;
    }
    .nav-link:hover { background: rgba(0,0,0,.04); color: var(--text); }
    html.dark .nav-link:hover { background: rgba(255,255,255,.07); }
    .nav-link.active { color: var(--text); font-weight: 600; }
    .dark-toggle {
      width: 32px; height: 32px; border: none; background: transparent;
      border-radius: 0; cursor: pointer; color: var(--sub);
      display: flex; align-items: center; justify-content: center;
      transition: background .15s, color .15s;
    }
    .dark-toggle:hover { background: rgba(0,0,0,.06); color: var(--text); }
    html.dark .dark-toggle:hover { background: rgba(255,255,255,.08); }

    /* ── Split layout ── */
    .pg-layout {
      display: grid; grid-template-columns: 400px 1fr;
      flex: 1; overflow: hidden;
    }

    /* ── Request panel ── */
    .req-panel {
      display: flex; flex-direction: column;
      background: var(--surface);
      border-right: 1px solid var(--border);
      overflow: hidden;
    }

    .panel-hd {
      padding: 13px 20px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between; flex-shrink: 0;
    }
    .panel-label {
      font-size: 10.5px; font-weight: 700; text-transform: uppercase;
      letter-spacing: .8px; color: var(--sub);
    }

    /* URL bar */
    .url-bar {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-bottom: 1px solid var(--border);
      background: var(--bg); flex-shrink: 0;
    }
    .method-sel {
      height: 34px; padding: 0 10px; border: 1.5px solid var(--border); border-radius: 0;
      font-size: 12px; font-weight: 700; font-family: var(--font); color: var(--blue);
      background: var(--surface); cursor: pointer; outline: none;
      appearance: none; -webkit-appearance: none; min-width: 68px;
    }
    .url-in {
      flex: 1; height: 34px; padding: 0 12px; border: 1.5px solid var(--border); border-radius: 0;
      font-size: 12px; font-family: var(--mono); color: var(--text); background: var(--surface); outline: none;
      transition: border-color .15s;
    }
    .url-in:focus { border-color: var(--blue); }
    .btn-send {
      height: 34px; padding: 0 18px; background: var(--blue); color: #fff;
      border: none; border-radius: 0; font-size: 13px; font-weight: 600;
      font-family: var(--font); cursor: pointer; display: flex; align-items: center; gap: 6px;
      transition: background .15s, transform .15s; flex-shrink: 0;
    }
    .btn-send:hover { background: var(--blue-h); transform: translateY(-1px); }
    .btn-send:active { transform: scale(.97); }
    .btn-send:disabled { background: #B0C4E8; cursor: not-allowed; transform: none; }
    .send-spin {
      display: none; width: 13px; height: 13px;
      border: 2px solid rgba(255,255,255,.35); border-top-color: #fff;
      border-radius: 50%; animation: spin .6s linear infinite;
    }
    .btn-send.loading .send-spin { display: block; }
    .btn-send.loading .send-icon { display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Tabs */
    .tab-bar { display: flex; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .tab-item {
      font-size: 13px; font-weight: 500; padding: 9px 16px;
      color: var(--sub); cursor: pointer;
      border-bottom: 2px solid transparent; transition: color .12s; user-select: none;
    }
    .tab-item:hover { color: var(--text); }
    .tab-item.active { color: var(--blue); border-bottom-color: var(--blue); }

    /* Scrollable params form */
    .tab-pane {
      flex: 1; overflow-y: auto; padding: 14px 16px;
      display: flex; flex-direction: column; gap: 11px;
    }
    .tab-pane.hidden { display: none; }

    .fsec-label {
      font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .6px;
      color: var(--sub); padding: 3px 0 2px; border-bottom: 1px solid var(--border);
    }

    /* Form fields */
    .field { display: flex; flex-direction: column; gap: 5px; }
    .field label { font-size: 11px; font-weight: 600; color: var(--sub); }
    .field input, .field select, .field textarea {
      height: 36px; padding: 0 11px; border: 1.5px solid var(--border); border-radius: 0;
      font-size: 13px; font-family: var(--font); color: var(--text);
      background: var(--bg); outline: none; appearance: none; -webkit-appearance: none;
      transition: border-color .15s, box-shadow .15s;
    }
    .field input:focus, .field select:focus, .field textarea:focus {
      border-color: var(--blue); box-shadow: 0 0 0 3px rgba(0,113,227,.1);
    }
    .field input::placeholder { color: #B0B0B5; }
    .field select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236E6E73' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 10px center; padding-right: 28px;
    }
    .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 9px; }

    /* Site chips */
    .sites-grid { display: flex; flex-wrap: wrap; gap: 6px; }
    .site-chip {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 5px 12px; border-radius: 0; border: 1.5px solid var(--border);
      font-size: 12px; font-weight: 500; color: var(--sub);
      cursor: pointer; user-select: none; background: var(--surface);
      transition: all .2s cubic-bezier(.34,1.56,.64,1);
    }
    .site-chip:hover { border-color: var(--blue); color: var(--blue); transform: scale(1.04); }
    .site-chip input[type="checkbox"] { display: none; }
    .chip-dot { width: 5px; height: 5px; border-radius: 0; background: var(--blue); opacity: 0; transform: scale(0); transition: opacity .15s, transform .2s cubic-bezier(.34,1.56,.64,1); }
    .site-chip.active { background: rgba(0,113,227,.08); border-color: rgba(0,113,227,.3); color: var(--blue); font-weight: 600; }
    .site-chip.active .chip-dot { opacity: 1; transform: scale(1); }

    /* JSON editor */
    .json-wrap { flex: 1; display: none; flex-direction: column; overflow: hidden; }
    .json-wrap.visible { display: flex; }
    .json-toolbar {
      padding: 8px 14px; border-bottom: 1px solid var(--border);
      display: flex; gap: 7px; flex-shrink: 0; background: var(--surface);
    }
    .json-tool {
      font-size: 11.5px; font-weight: 500; padding: 4px 10px;
      border: 1.5px solid var(--border); border-radius: 0;
      cursor: pointer; font-family: var(--font); background: var(--bg); color: var(--sub);
      transition: all .12s;
    }
    .json-tool:hover { border-color: var(--blue); color: var(--blue); }
    .json-editor {
      flex: 1; border: none; padding: 14px 16px; font-family: var(--mono);
      font-size: 12.5px; line-height: 1.65; color: var(--text);
      background: var(--bg); resize: none; outline: none;
    }

    /* ── Response panel ── */
    .res-panel {
      display: flex; flex-direction: column; overflow: hidden;
      background: var(--dark-bg);
    }

    .res-hd {
      padding: 12px 20px; border-bottom: 1px solid var(--dark-border);
      display: flex; align-items: center; gap: 14px; flex-shrink: 0;
    }
    .res-label { font-size: 10.5px; font-weight: 700; text-transform: uppercase; letter-spacing: .8px; color: #555; }
    .status-chip {
      font-size: 11.5px; font-weight: 600; padding: 3px 11px; border-radius: 0;
      background: rgba(255,255,255,.06); color: #666; font-family: var(--mono);
      transition: background .2s, color .2s;
    }
    .status-chip.ok   { background: rgba(52,199,89,.14);  color: #34C759; }
    .status-chip.err  { background: rgba(255,59,48,.14);  color: #FF3B30; }
    .status-chip.warn { background: rgba(255,149,0,.14);  color: #FF9500; }
    .timing { font-size: 12px; color: #555; }
    .cnt-label { font-size: 12px; color: #555; margin-left: auto; }

    .res-tabs { display: flex; border-bottom: 1px solid var(--dark-border); flex-shrink: 0; }
    .res-tab {
      font-size: 13px; font-weight: 500; padding: 9px 16px;
      color: #555; cursor: pointer; border-bottom: 2px solid transparent;
      transition: color .12s; user-select: none;
    }
    .res-tab:hover { color: #999; }
    .res-tab.active { color: #E0E0E0; border-bottom-color: var(--blue); }

    .res-body { flex: 1; overflow-y: auto; padding: 16px 20px; position: relative; }

    .res-placeholder {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100%; gap: 10px; color: #444; text-align: center;
    }
    .res-placeholder .pi { font-size: 36px; margin-bottom: 4px; }
    .res-placeholder p { font-size: 14px; line-height: 1.55; }
    .res-placeholder strong { color: #888; }

    pre.rjson {
      font-family: var(--mono); font-size: 12.5px; line-height: 1.68;
      color: #D0D0D0; white-space: pre-wrap; word-break: break-word;
    }
    .j-key  { color: #79C0FF; }
    .j-str  { color: #9ECA7F; }
    .j-num  { color: #FFA966; }
    .j-bool { color: #F97680; }
    .j-null { color: #636375; }

    .copy-res {
      position: absolute; top: 12px; right: 16px;
      font-size: 11px; padding: 4px 10px; border-radius: 0;
      border: 1px solid rgba(255,255,255,.1); background: rgba(255,255,255,.05); color: #888;
      cursor: pointer; font-family: var(--font); transition: background .12s, color .12s;
    }
    .copy-res:hover { background: rgba(255,255,255,.1); color: #ddd; }

    /* Jobs list view */
    .jobs-list { display: none; flex-direction: column; gap: 8px; }
    .jobs-list.visible { display: flex; }
    .mini-card { background: var(--dark-surf); border-radius: 0; padding: 12px 14px; border: 1px solid var(--dark-border); }
    .mc-title { font-size: 14px; font-weight: 600; color: #E0E0E0; margin-bottom: 3px; }
    .mc-sub   { font-size: 12px; color: #666; }
    .mc-meta  { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 7px; }
    .mc-tag   { font-size: 11px; background: rgba(255,255,255,.06); color: #888; padding: 3px 8px; border-radius: 0; }
    .mc-tag.remote { color: #34C759; background: rgba(52,199,89,.12); }
    .mc-link  { font-size: 12px; color: var(--blue); text-decoration: none; display: block; margin-top: 6px; }
    .mc-link:hover { text-decoration: underline; }

    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(128,128,128,.25); border-radius: 0; }

    @media (max-width: 800px) {
      .pg-layout { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; overflow: auto; }
      body { overflow: auto; height: auto; }
      .res-panel { min-height: 420px; }
    }
  </style>
  <script>if(localStorage.getItem('theme')!=='light')document.documentElement.classList.add('dark');</script>
</head>
<body>

<nav>
  <a class="nav-logo" href="/">
    <div class="nav-logo-mark">
      <svg width="22" height="22" viewBox="0 0 20 20" fill="none">
        <rect x='2' y='7' width='16' height='11' stroke='currentColor' stroke-width='1.5' fill='none'/>
        <path d='M7 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2' stroke='currentColor' stroke-width='1.5' fill='none'/>
        <circle cx='9.5' cy='12.5' r='2.8' stroke='currentColor' stroke-width='1.3' fill='none'/>
        <path d='M11.5 14.5L13.5 16.5' stroke='currentColor' stroke-width='1.3' stroke-linecap='round'/>
      </svg>
    </div>
    Job API
  </a>
  <div class="nav-links">
    <a href="/" class="nav-link">Search</a>
    <a href="/docs.html" class="nav-link">Docs</a>
    <a href="/playground.html" class="nav-link active">Playground</a>
  </div>
  <button class="dark-toggle" id="darkToggle" title="Toggle theme">
    <svg id="iconMoon" width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M14 9.5A6.5 6.5 0 017.5 3a6.5 6.5 0 100 13A6.5 6.5 0 0014 9.5z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/></svg>
    <svg id="iconSun" width="16" height="16" viewBox="0 0 16 16" fill="none" style="display:none"><circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M8 1.5v1M8 13.5v1M1.5 8h1M13.5 8h1M3.4 3.4l.7.7M11.9 11.9l.7.7M3.4 12.6l.7-.7M11.9 4.1l.7-.7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
  </button>
</nav>

<div class="pg-layout">

  <!-- ── REQUEST PANEL ── -->
  <div class="req-panel">
    <div class="panel-hd">
      <span class="panel-label">Request</span>
    </div>

    <div class="url-bar">
      <select class="method-sel" id="methodSel" onchange="onMethodChange()">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
      </select>
      <input class="url-in" id="urlIn" value="/api/jobs" readonly />
      <button class="btn-send" id="sendBtn" onclick="sendRequest()">
        <span class="send-icon">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M1 6h10M7 1.5l4.5 4.5L7 10.5" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <div class="send-spin"></div>
        Send
      </button>
    </div>

    <div class="tab-bar">
      <div class="tab-item active" onclick="switchReqTab(this,'params')">Params</div>
      <div class="tab-item" onclick="switchReqTab(this,'body')">Body (JSON)</div>
    </div>

    <!-- Params tab -->
    <div class="tab-pane" id="req-params">
      <div class="fsec-label">Job Boards</div>
      <div class="sites-grid" id="sitesGrid">
        <label class="site-chip active"><input type="checkbox" value="indeed" checked><span class="chip-dot"></span>Indeed</label>
        <label class="site-chip active"><input type="checkbox" value="linkedin" checked><span class="chip-dot"></span>LinkedIn</label>
        <label class="site-chip"><input type="checkbox" value="glassdoor"><span class="chip-dot"></span>Glassdoor</label>
        <label class="site-chip"><input type="checkbox" value="zip_recruiter"><span class="chip-dot"></span>ZipRecruiter</label>
        <label class="site-chip"><input type="checkbox" value="google"><span class="chip-dot"></span>Google</label>
        <label class="site-chip"><input type="checkbox" value="bayt"><span class="chip-dot"></span>Bayt</label>
        <label class="site-chip"><input type="checkbox" value="naukri"><span class="chip-dot"></span>Naukri</label>
        <label class="site-chip"><input type="checkbox" value="bdjobs"><span class="chip-dot"></span>BDJobs</label>
      </div>

      <div class="fsec-label">Search</div>
      <div class="field">
        <label>search_term</label>
        <input id="p_st" type="text" placeholder="e.g. software engineer" />
      </div>
      <div class="field-row">
        <div class="field"><label>location</label><input id="p_loc" type="text" placeholder="New York, NY" /></div>
        <div class="field">
          <label>country_indeed</label>
          <select id="p_ci">
            <option value="">Any</option>
            <option value="USA" selected>USA</option>
            <option value="UK">UK</option>
            <option value="Canada">Canada</option>
            <option value="Australia">Australia</option>
            <option value="Germany">Germany</option>
            <option value="France">France</option>
            <option value="India">India</option>
            <option value="Singapore">Singapore</option>
            <option value="UAE">UAE</option>
          </select>
        </div>
      </div>

      <div class="fsec-label">Filters</div>
      <div class="field-row">
        <div class="field">
          <label>job_type</label>
          <select id="p_jt">
            <option value="">Any</option>
            <option value="fulltime">Full-time</option>
            <option value="parttime">Part-time</option>
            <option value="contract">Contract</option>
            <option value="internship">Internship</option>
          </select>
        </div>
        <div class="field">
          <label>is_remote</label>
          <select id="p_ir"><option value="">Any</option><option value="true">Remote only</option><option value="false">On-site only</option></select>
        </div>
      </div>
      <div class="field-row">
        <div class="field"><label>results_wanted</label><input id="p_rw" type="number" placeholder="15" value="15" min="1" max="100"/></div>
        <div class="field"><label>hours_old</label><input id="p_ho" type="number" placeholder="e.g. 72"/></div>
      </div>
      <div class="field-row">
        <div class="field"><label>distance (miles)</label><input id="p_dist" type="number" placeholder="50"/></div>
        <div class="field"><label>offset</label><input id="p_off" type="number" placeholder="0"/></div>
      </div>

      <div class="fsec-label">Advanced</div>
      <div class="field-row">
        <div class="field">
          <label>description_format</label>
          <select id="p_df"><option value="markdown" selected>markdown</option><option value="html">html</option></select>
        </div>
        <div class="field">
          <label>easy_apply</label>
          <select id="p_ea"><option value="">Any</option><option value="true">Yes</option><option value="false">No</option></select>
        </div>
      </div>
      <div class="field"><label>linkedin_company_ids</label><input id="p_lci" type="text" placeholder="1441,2382"/></div>
      <div class="field"><label>google_search_term</label><input id="p_gst" type="text" placeholder="software engineer jobs near New York"/></div>
      <div class="field-row">
        <div class="field">
          <label>linkedin_fetch_description</label>
          <select id="p_lfd"><option value="false" selected>false (fast)</option><option value="true">true (slow)</option></select>
        </div>
        <div class="field">
          <label>enforce_annual_salary</label>
          <select id="p_eas"><option value="false" selected>false</option><option value="true">true</option></select>
        </div>
      </div>
    </div>

    <!-- Body (JSON) tab -->
    <div class="json-wrap" id="req-body">
      <div class="json-toolbar">
        <button class="json-tool" onclick="fillTpl()">Fill Template</button>
        <button class="json-tool" onclick="prettify()">Prettify</button>
        <button class="json-tool" onclick="clearBody()">Clear</button>
      </div>
      <textarea class="json-editor" id="jsonBody" placeholder='{
  "search_term": "software engineer",
  "location": "New York, NY",
  "site_name": ["indeed", "linkedin"],
  "results_wanted": 15
}'></textarea>
    </div>
  </div>

  <!-- ── RESPONSE PANEL ── -->
  <div class="res-panel">
    <div class="res-hd">
      <span class="res-label">Response</span>
      <span class="status-chip" id="statusChip">&mdash;</span>
      <span class="timing" id="timing"></span>
      <span class="cnt-label" id="cntLabel"></span>
    </div>

    <div class="res-tabs">
      <div class="res-tab active" onclick="switchResTab(this,'json')">JSON</div>
      <div class="res-tab" onclick="switchResTab(this,'jobs')">Jobs</div>
    </div>

    <div class="res-body" id="res-json-view">
      <div class="res-placeholder" id="resPlaceholder">
        <div class="pi">&#128640;</div>
        <p>Configure your request<br>and hit <strong>Send</strong> to see the response.</p>
      </div>
      <button class="copy-res" id="copyResBtn" style="display:none" onclick="copyRes()">Copy</button>
      <pre class="rjson" id="rjsonEl"></pre>
    </div>

    <div class="res-body" id="res-jobs-view" style="display:none">
      <div class="jobs-list" id="jobsList"></div>
    </div>
  </div>
</div>

<script>
  let lastResponse = null;
  let activeResTab = 'json';

  // Chips
  document.querySelectorAll('.site-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const cb = chip.querySelector('input');
      cb.checked = !cb.checked;
      chip.classList.toggle('active', cb.checked);
    });
  });

  function onMethodChange() {
    if (document.getElementById('methodSel').value === 'POST') {
      switchReqTab(document.querySelector('.tab-item[onclick*="body"]'), 'body');
    }
  }

  function switchReqTab(btn, tab) {
    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    const params = document.getElementById('req-params');
    const body   = document.getElementById('req-body');
    if (tab === 'params') {
      params.style.display = 'flex';
      body.classList.remove('visible');
    } else {
      params.style.display = 'none';
      body.classList.add('visible');
    }
  }

  function switchResTab(btn, tab) {
    document.querySelectorAll('.res-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    activeResTab = tab;
    document.getElementById('res-json-view').style.display = tab === 'json' ? 'block' : 'none';
    document.getElementById('res-jobs-view').style.display = tab === 'jobs' ? 'block' : 'none';
    if (tab === 'jobs') renderJobsTab();
  }

  function buildParams() {
    const get = id => (document.getElementById(id)?.value?.trim() || '');
    const sites = [...document.querySelectorAll('.site-chip input:checked')].map(c => c.value);
    const p = new URLSearchParams();
    if (sites.length) p.set('site_name', sites.join(','));
    if (get('p_st'))    p.set('search_term',   get('p_st'));
    if (get('p_loc'))   p.set('location',      get('p_loc'));
    if (get('p_ci'))    p.set('country_indeed', get('p_ci'));
    if (get('p_jt'))    p.set('job_type',       get('p_jt'));
    if (get('p_ir'))    p.set('is_remote',      get('p_ir'));
    if (get('p_rw'))    p.set('results_wanted', get('p_rw'));
    if (get('p_ho'))    p.set('hours_old',      get('p_ho'));
    if (get('p_dist'))  p.set('distance',       get('p_dist'));
    if (get('p_off'))   p.set('offset',         get('p_off'));
    if (get('p_df'))    p.set('description_format', get('p_df'));
    if (get('p_ea'))    p.set('easy_apply',     get('p_ea'));
    if (get('p_lci'))   p.set('linkedin_company_ids', get('p_lci'));
    if (get('p_gst'))   p.set('google_search_term',   get('p_gst'));
    if (get('p_lfd') === 'true')  p.set('linkedin_fetch_description', 'true');
    if (get('p_eas') === 'true')  p.set('enforce_annual_salary', 'true');
    return p;
  }

  function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  async function sendRequest() {
    const method  = document.getElementById('methodSel').value;
    const btn     = document.getElementById('sendBtn');
    const isBody  = document.getElementById('req-body').classList.contains('visible');

    btn.disabled = true; btn.classList.add('loading');

    const chip    = document.getElementById('statusChip');
    const timing  = document.getElementById('timing');
    const cnt     = document.getElementById('cntLabel');
    chip.className = 'status-chip';
    chip.textContent = '\u2026';
    timing.textContent = '';
    cnt.textContent = '';
    document.getElementById('resPlaceholder').style.display = 'none';
    document.getElementById('rjsonEl').innerHTML = '';
    document.getElementById('copyResBtn').style.display = 'none';

    const t0 = performance.now();

    try {
      let res;
      if (method === 'GET' || !isBody) {
        res = await fetch(`/api/jobs?${buildParams()}`, { method: 'GET' });
      } else {
        let body = document.getElementById('jsonBody').value.trim() || '{}';
        let parsed;
        try { parsed = JSON.parse(body); }
        catch(e) { showErr(`Invalid JSON: ${e.message}`); btn.disabled=false; btn.classList.remove('loading'); return; }
        res = await fetch('/api/jobs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(parsed),
        });
      }

      const ms   = Math.round(performance.now() - t0);
      const data = await res.json();
      lastResponse = data;

      chip.textContent  = `${res.status} ${res.statusText || (res.ok ? 'OK' : 'Error')}`;
      chip.className    = 'status-chip ' + (res.ok ? 'ok' : res.status < 500 ? 'warn' : 'err');
      timing.textContent = `${ms} ms`;
      if (data.count != null) cnt.textContent = `${data.count} job${data.count !== 1 ? 's' : ''}`;

      document.getElementById('rjsonEl').innerHTML = syntaxHL(JSON.stringify(data, null, 2));
      document.getElementById('copyResBtn').style.display = 'block';

      if (activeResTab === 'jobs') renderJobsTab();
    } catch(err) {
      showErr(err.message);
    } finally {
      btn.disabled = false; btn.classList.remove('loading');
    }
  }

  function showErr(msg) {
    const chip = document.getElementById('statusChip');
    chip.textContent = 'Error'; chip.className = 'status-chip err';
    document.getElementById('rjsonEl').innerHTML = `<span style="color:#FF3B30">${esc(msg)}</span>`;
    document.getElementById('copyResBtn').style.display = 'block';
  }

  function renderJobsTab() {
    const list = document.getElementById('jobsList');
    if (!lastResponse || !lastResponse.jobs) {
      list.innerHTML = '<p style="color:#555;text-align:center;padding:32px 0">No job data yet &mdash; run a search first.</p>';
      list.classList.add('visible'); return;
    }
    const jobs = lastResponse.jobs;
    if (!jobs.length) {
      list.innerHTML = '<p style="color:#555;text-align:center;padding:32px 0">No jobs found for that query.</p>';
      list.classList.add('visible'); return;
    }
    list.innerHTML = jobs.map(j => {
      const loc  = j.location ? [j.location.city, j.location.state, j.location.country].filter(Boolean).join(', ') : '';
      const tags = [j.site, j.job_type, j.is_remote ? 'remote' : null, loc].filter(Boolean);
      return `<div class="mini-card">
        <div class="mc-title">${esc(j.title || 'Untitled')}</div>
        <div class="mc-sub">${esc(j.company || '')}${j.date_posted ? ' &middot; ' + j.date_posted : ''}</div>
        <div class="mc-meta">${tags.map(t => `<span class="mc-tag${t==='remote'?' remote':''}">${esc(t)}</span>`).join('')}</div>
        ${j.job_url ? `<a class="mc-link" href="${esc(j.job_url)}" target="_blank" rel="noopener">Apply &rarr;</a>` : ''}
      </div>`;
    }).join('');
    list.classList.add('visible');
  }

  function syntaxHL(json) {
    return json
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, m => {
        let cls = 'j-num';
        if (/^"/.test(m)) cls = /:$/.test(m) ? 'j-key' : 'j-str';
        else if (/true|false/.test(m)) cls = 'j-bool';
        else if (/null/.test(m)) cls = 'j-null';
        return `<span class="${cls}">${m}</span>`;
      });
  }

  function copyRes() {
    const text = document.getElementById('rjsonEl').innerText;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyResBtn');
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 1500);
    });
  }

  function fillTpl() {
    document.getElementById('jsonBody').value = JSON.stringify({
      site_name: ['indeed', 'linkedin'],
      search_term: 'software engineer',
      location: 'New York, NY',
      country_indeed: 'USA',
      results_wanted: 15,
      hours_old: 72,
      job_type: 'fulltime',
      is_remote: false,
      description_format: 'markdown',
    }, null, 2);
  }

  function prettify() {
    const ta = document.getElementById('jsonBody');
    try { ta.value = JSON.stringify(JSON.parse(ta.value), null, 2); }
    catch(e) { alert('Invalid JSON: ' + e.message); }
  }

  function clearBody() { document.getElementById('jsonBody').value = ''; }

  // Ctrl/Cmd + Enter to send
  document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') sendRequest();
  });

  // Dark mode
  (function() {
    const root = document.documentElement;
    const btn  = document.getElementById('darkToggle');
    const moon = document.getElementById('iconMoon');
    const sun  = document.getElementById('iconSun');
    function apply(on) {
      root.classList.toggle('dark', on);
      moon.style.display = on ? 'none' : 'block';
      sun.style.display  = on ? 'block' : 'none';
    }
    apply(localStorage.getItem('theme') !== 'light');
    btn.addEventListener('click', () => {
      const d = !root.classList.contains('dark');
      apply(d); localStorage.setItem('theme', d ? 'dark' : 'light');
    });
  })();
</script>
</body>
</html>
